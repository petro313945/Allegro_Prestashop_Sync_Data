<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allegro → PrestaShop Integration</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Login Screen - Shown First -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="login-header">
                <h1>Allegro → PrestaShop Integration</h1>
            </div>
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" placeholder="Enter your email" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password" required autocomplete="current-password">
                </div>
                <div id="loginErrorMessage" class="error-message" style="display: none;"></div>
                <button type="submit" id="loginSubmitBtn" class="btn btn-primary btn-block">Log In</button>
            </form>
        </div>
    </div>

    <!-- Main Application Layout - Hidden Until Login -->
    <div id="mainApp" class="main-app" style="display: none;">
        <!-- Top Header -->
        <header class="top-header">
            <div class="header-content">
                <div class="app-title">
                    <h1>Allegro → PrestaShop Integration</h1>
                </div>
                <div class="user-info">
                    <div class="status-item">
                        <div class="user-display">
                            <span class="user-icon">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 12C14.7614 12 17 9.76142 17 7C17 4.23858 14.7614 2 12 2C9.23858 2 7 4.23858 7 7C7 9.76142 9.23858 12 12 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M20.59 22C20.59 18.13 16.74 15 12 15C7.26 15 3.41 18.13 3.41 22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span id="userDisplay" class="user-status-badge"></span>
                        </div>
                        <button id="logoutBtn" class="btn btn-secondary btn-small" style="margin-left: 10px; padding: 4px 12px; font-size: 12px;">Logout</button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Configuration Panel - Collapsible -->
        <div class="config-panel-wrapper">
            <div class="config-panel-toggle" id="configPanelToggle">
                <span class="toggle-icon">▼</span>
                <span class="toggle-text">Configuration</span>
                <div class="config-quick-status">
                    <span id="authStatus" class="quick-status-badge error">API Credentials: Pending</span>
                    <span id="oauthStatus" class="quick-status-badge error">OAuth: Not Connected</span>
                    <span id="allegroQuickStatus" class="quick-status-badge error">Allegro: Not Configured</span>
                    <span id="prestashopQuickStatus" class="quick-status-badge error">PrestaShop: Not Configured</span>
                </div>
            </div>
            <div class="config-panel" id="configPanel">
                <div class="config-section">
                    <div class="config-header">
                        <div class="config-header-left">
                            <h2>Allegro API Configuration</h2>
                            <span id="allegroConfigStatus" class="config-status">Not Configured</span>
                        </div>
                    </div>
                    <div class="config-content">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="clientId">Client ID</label>
                                <input type="text" id="clientId" placeholder="Enter Allegro Client ID" autocomplete="off">
                            </div>
                            <div class="form-group">
                                <label for="clientSecret">Client Secret</label>
                                <input type="password" id="clientSecret" placeholder="Enter Allegro Client Secret" autocomplete="off">
                            </div>
                        </div>
                        <div class="form-actions">
                            <button id="saveCredentialsBtn" class="btn btn-primary">Connect</button>
                            <button id="clearCredentialsBtn" class="btn btn-secondary" style="display: none;">Disconnect</button>
                            <button id="authorizeAccountBtn" class="btn btn-primary" style="display: none;">Authorize Account</button>
                        </div>
                        <div id="oauthInfo" style="display: none;"></div>
                        <div id="credentialsMessage" class="message" style="display: none;"></div>
                    </div>
                </div>

                <div class="config-section">
                    <div class="config-header">
                        <div class="config-header-left">
                            <h2>PrestaShop Configuration</h2>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span id="prestashopConfigStatus" class="config-status">Not Configured</span>
                                <span id="prestashopSavedConfigInfo" class="config-status success" style="display: none;">Saved</span>
                            </div>
                        </div>
                    </div>
                    <div class="config-content">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="prestashopUrl">Base URL</label>
                                <input type="text" id="prestashopUrl" placeholder="https://www.interkul.net" autocomplete="off">
                            </div>
                            <div class="form-group">
                                <label for="prestashopApiKey">API Key</label>
                                <input type="password" id="prestashopApiKey" placeholder="Enter PrestaShop API Key" autocomplete="off">
                            </div>
                        </div>
                        <div class="form-actions">
                            <button id="testPrestashopBtn" class="btn btn-secondary">Connect</button>
                            <button id="clearPrestashopBtn" class="btn btn-secondary" style="display: none;">Disconnect</button>
                        </div>
                        <div id="prestashopMessage" class="message" style="display: none;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Wrapper -->
        <div class="main-content-wrapper">
            <!-- Left Sidebar - Categories -->
            <aside class="sidebar">
                <div class="sidebar-header">
                    <div class="sidebar-header-title-row">
                        <h2>Categories</h2>
                        <button id="syncCategoriesBtn" class="btn btn-primary btn-small" disabled>Sync Category</button>
                    </div>
                </div>
                <div class="categories-list" id="categoriesList"></div>
            </aside>

            <!-- Right Content Area - Tabbed Navigation -->
            <main class="content-area">
                <!-- Tab Navigation -->
                <div class="tab-navigation">
                    <button class="tab-btn active" data-tab="offers">
                        <span>Allegro Offers</span>
                    </button>
                    <button class="tab-btn" data-tab="imported">
                        <span>Imported Products</span>
                        <span id="tabImportedCount" class="tab-badge">0</span>
                    </button>
                    <button class="tab-btn" data-tab="sync-log">
                        <span>Sync Stock Log</span>
                    </button>
                    <button class="tab-btn" data-tab="csv">
                        <span>CSV Export</span>
                    </button>
                    <button class="tab-btn" data-tab="user-management" id="userManagementTab" style="display: none;">
                        <span>User Management</span>
                    </button>
                </div>

                <!-- Tab Content: Offers -->
                <div class="tab-content active" id="tab-offers">
                    <div class="section-card">
                        <div class="section-header">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <button id="loadOffersBtn" class="btn btn-primary" disabled>Load Offers</button>
                                <button id="selectAllOffersBtn" class="btn btn-secondary" style="display: none;">Select All</button>
                            </div>
                            <div class="section-actions">
                                <div class="form-group-inline">
                                    <label for="statusFilter">Status:</label>
                                    <select id="statusFilter" style="min-width: 120px;">
                                        <option value="ALL" selected>All</option>
                                        <option value="ACTIVE">Active</option>
                                        <option value="ENDED">Ended</option>
                                    </select>
                                </div>
                                <div class="offers-search-wrapper">
                                    <input 
                                        type="text" 
                                        id="offerSearchInput" 
                                        class="offers-search-input" 
                                        placeholder="Search offers..."
                                        autocomplete="off">
                                </div>
                                <button id="clearBtn" class="btn btn-secondary" onclick="clearSearch()">Clear</button>
                                <button id="importSelectedBtn" class="btn btn-success" disabled>Import Selected</button>
                            </div>
                        </div>
                        
                        <div id="authRequiredMessage" class="auth-required-message" style="display: none;">
                            Authentication required. Please configure Allegro API first.
                        </div>

                        <div id="loadingIndicator" class="loading" style="display: none;">
                            <div class="spinner"></div>
                            <p>Loading...</p>
                        </div>

                        <div id="errorMessage" class="error-message" style="display: none;">
                            <div class="error-message-content"></div>
                            <button class="error-message-close" onclick="closeErrorMessage()" title="Close">×</button>
                        </div>

                        <div class="pagination" id="pagination" style="display: none;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <button id="prevBtn" class="btn btn-secondary" disabled>Prev</button>
                                <span id="pageInfo">Page 1</span>
                                <button id="nextBtn" class="btn btn-secondary" disabled>Next</button>
                                <div style="display: flex; align-items: center; gap: 5px; margin-left: 15px;">
                                    <label for="pageJumpInput" style="font-size: 14px; color: #666;">Go to:</label>
                                    <input type="number" id="pageJumpInput" min="1" value="1" style="width: 60px; padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <button id="pageJumpBtn" class="btn btn-primary btn-small">Go</button>
                                </div>
                            </div>
                            <span id="totalCountInfo" class="total-count-info"></span>
                        </div>

                        <div id="offersList" class="offers-grid"></div>
                    </div>
                </div>

                <!-- Tab Content: Imported Products -->
                <div class="tab-content" id="tab-imported">
                    <div class="section-card">
                        <div class="section-header">
                            <div class="section-actions">
                                <button id="clearImportedBtn" class="btn btn-secondary btn-small" disabled>Clear</button>
                                <button id="exportToPrestashopBtn" class="btn btn-success btn-small" disabled>Export to PrestaShop</button>
                            </div>
                        </div>
                        <div id="exportProgress" class="export-progress" style="display: none;">
                            <div class="export-progress-bar">
                                <div id="exportProgressBarFill" class="export-progress-fill"></div>
                            </div>
                            <div id="exportProgressText" class="export-progress-text">Preparing export…</div>
                        </div>
                        <div id="importedList" class="imported-list"></div>
                    </div>
                </div>

                <!-- Tab Content: CSV Export -->
                <div class="tab-content" id="tab-csv">
                    <div class="section-card">
                        <div class="csv-export-grid">
                            <div class="csv-export-card">
                            <h3>Export Categories</h3>
                            <p>Export categories from your Allegro offers to a CSV file</p>
                            <button id="exportCategoriesCsvBtn" class="btn btn-primary" disabled>Export Categories</button>
                            </div>
                            <div class="csv-export-card">
                                <h3>Export Products</h3>
                                <p>Export all imported products to a CSV file</p>
                                <button id="exportProductsCsvBtn" class="btn btn-primary" disabled>Export Products</button>
                            </div>
                        </div>
                        <div id="csvExportMessage" class="message" style="display: none; margin-top: 20px;"></div>
                    </div>
                </div>

                <!-- Tab Content: Sync Stock Log -->
                <div class="tab-content" id="tab-sync-log">
                    <div class="section-card">
                        <div class="section-header" style="margin-bottom: 15px;">
                            <div class="sync-header-container" style="overflow: hidden;">
                                <div class="sync-header-left">
                                    <div class="sync-status" id="syncStatus" style="display: flex; flex-direction: row; gap: 20px; flex-wrap: wrap; margin-top: 0;">
                                        <div class="sync-status-row">
                                            <span class="sync-status-label">Last Sync:</span>
                                            <span id="lastSyncTime" class="sync-status-value">Never</span>
                                            <span id="timeSinceLastSync" class="sync-time-elapsed"></span>
                                        </div>
                                        <div class="sync-status-row">
                                            <span class="sync-status-label">Next Sync:</span>
                                            <span id="nextSyncTime" class="sync-status-value">-</span>
                                            <span id="timeUntilNextSync" class="sync-time-countdown"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="sync-header-right">
                                    <button id="startSyncBtn" class="btn btn-success" disabled>
                                        <span id="startSyncBtnText">Start Automatic Sync</span>
                                    </button>
                                    <button id="stopSyncBtn" class="btn btn-danger" style="display: none;">
                                        <span>Stop Sync Timer</span>
                                    </button>
                                    <button id="triggerSyncBtn" class="btn btn-primary" disabled>
                                        <span>Sync Now</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div id="syncPrerequisitesMsg" class="message" style="display: none; margin-bottom: 15px;"></div>
                        <div style="margin-bottom: 2px; padding-bottom: 2px; overflow: hidden;">
                            <div class="sync-status-row" style="float: left; margin: 0; margin-left: 8px; font-size: 0.9em; color: #333; font-weight: normal;">Sync Status: <span id="syncTimerStatus" class="sync-status-value">Stopped</span></div>
                        </div>
                        <div id="syncStatisticsContainer" class="sync-statistics-container">
                            <div id="syncStatisticsList" class="sync-statistics-list"></div>
                            <div id="syncStatisticsLoading" class="loading" style="display: none;">
                                <div class="spinner"></div>
                                <p>Waiting for sync completion...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: User Management -->
                <div class="tab-content" id="tab-user-management">
                    <div class="section-card">
                        <div class="section-header">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <h2 style="margin: 0;">User Management</h2>
                            </div>
                            <div class="section-actions">
                                <button id="createUserBtn" class="btn btn-primary">Create New User</button>
                                <button id="refreshUsersBtn" class="btn btn-secondary">Refresh</button>
                            </div>
                        </div>

                        <!-- Create/Edit User Modal -->
                        <div id="userModal" class="modal" style="display: none;">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h3 id="userModalTitle">Create User</h3>
                                    <button class="modal-close" id="closeUserModal">&times;</button>
                                </div>
                                <div class="modal-body">
                                    <form id="userForm">
                                        <input type="hidden" id="userId" name="userId" value="">
                                        <div class="form-group">
                                            <label for="userEmail">Email *</label>
                                            <input type="email" id="userEmail" name="userEmail" required autocomplete="off">
                                        </div>
                                        <div class="form-group">
                                            <label for="userPassword">Password *</label>
                                            <input type="password" id="userPassword" name="userPassword" autocomplete="new-password">
                                            <small style="color: #666; font-size: 12px;">Leave blank to keep current password when editing</small>
                                        </div>
                                        <div class="form-group">
                                            <label for="userRole">Role</label>
                                            <div id="userRoleDisplay" style="padding: 8px; background-color: #f5f5f5; border: 1px solid #ddd; border-radius: 4px; color: #333;">User</div>
                                            <input type="hidden" id="userRole" name="userRole" value="user">
                                        </div>
                                        <div id="userFormError" class="error-message" style="display: none; margin-top: 10px;"></div>
                                        <div class="form-actions" style="margin-top: 20px;">
                                            <button type="submit" id="saveUserBtn" class="btn btn-primary">Save</button>
                                            <button type="button" id="cancelUserBtn" class="btn btn-secondary">Cancel</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Users Table -->
                        <div id="usersTableContainer" style="margin-top: 20px;">
                            <div id="usersLoading" class="loading" style="display: none;">
                                <div class="spinner"></div>
                                <p>Loading users...</p>
                            </div>
                            <div id="usersErrorMessage" class="error-message" style="display: none;"></div>
                            <table id="usersTable" class="users-table" style="display: none;">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Last Login</th>
                                        <th>Created At</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="app.js"></script>
</body>
</html>
