<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allegro → PrestaShop Integration</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Main Application Layout - Always Visible -->
    <div id="mainApp" class="main-app">
        <!-- Top Header -->
        <header class="top-header">
            <div class="header-content">
                <div class="app-title">
                    <h1>Allegro → PrestaShop Integration</h1>
                </div>
                <div class="user-info">
                    <div class="status-item">
                        <span class="status-label">Allegro Auth:</span>
                        <span id="authStatus" class="status-value error">Pending</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Account:</span>
                        <span id="oauthStatus" class="status-value error">Not Connected</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">PrestaShop:</span>
                        <span id="prestashopHeaderStatus" class="status-value error">Not Connected</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Configuration Panel - Collapsible -->
        <div class="config-panel-wrapper">
            <div class="config-panel-toggle" id="configPanelToggle">
                <span class="toggle-icon">▼</span>
                <span class="toggle-text">Configuration</span>
                <div class="config-quick-status">
                    <span id="allegroQuickStatus" class="quick-status-badge error">Allegro: Not Configured</span>
                    <span id="prestashopQuickStatus" class="quick-status-badge error">PrestaShop: Not Configured</span>
                </div>
            </div>
            <div class="config-panel" id="configPanel">
                <div class="config-section">
                    <div class="config-header">
                        <div class="config-header-left">
                            <h2>Allegro API Configuration</h2>
                            <span id="allegroConfigStatus" class="config-status">Not Configured</span>
                        </div>
                    </div>
                    <div class="config-content">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="clientId">Client ID</label>
                                <input type="text" id="clientId" placeholder="Enter Allegro Client ID" autocomplete="off">
                            </div>
                            <div class="form-group">
                                <label for="clientSecret">Client Secret</label>
                                <input type="password" id="clientSecret" placeholder="Enter Allegro Client Secret" autocomplete="off">
                            </div>
                        </div>
                        <div class="form-actions">
                            <button id="saveCredentialsBtn" class="btn btn-primary">Connect</button>
                            <button id="clearCredentialsBtn" class="btn btn-secondary" style="display: none;">Disconnect</button>
                            <button id="authorizeAccountBtn" class="btn btn-primary" style="display: none;">Authorize Account</button>
                        </div>
                        <div id="oauthInfo" style="display: none;"></div>
                        <div id="credentialsMessage" class="message" style="display: none;"></div>
                    </div>
                </div>

                <div class="config-section">
                    <div class="config-header">
                        <div class="config-header-left">
                            <h2>PrestaShop Configuration</h2>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span id="prestashopConfigStatus" class="config-status">Not Configured</span>
                                <span id="prestashopSavedConfigInfo" class="config-status success" style="display: none;">Saved</span>
                            </div>
                        </div>
                    </div>
                    <div class="config-content">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="prestashopUrl">Base URL</label>
                                <input type="text" id="prestashopUrl" placeholder="http://localhost/polandstore" autocomplete="off">
                            </div>
                            <div class="form-group">
                                <label for="prestashopApiKey">API Key</label>
                                <input type="password" id="prestashopApiKey" placeholder="Enter PrestaShop API Key" autocomplete="off">
                            </div>
                        </div>
                        <div class="form-actions">
                            <button id="testPrestashopBtn" class="btn btn-secondary">Connect</button>
                            <button id="clearPrestashopBtn" class="btn btn-secondary" style="display: none;">Disconnect</button>
                        </div>
                        <div id="prestashopMessage" class="message" style="display: none;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Wrapper -->
        <div class="main-content-wrapper">
            <!-- Left Sidebar - Categories -->
            <aside class="sidebar">
                <div class="sidebar-header">
                    <div class="sidebar-header-title-row">
                        <h2>Categories</h2>
                        <button id="syncCategoriesBtn" class="btn btn-primary btn-small" disabled>Sync Category</button>
                    </div>
                </div>
                <div class="categories-list" id="categoriesList"></div>
            </aside>

            <!-- Right Content Area - Tabbed Navigation -->
            <main class="content-area">
                <!-- Tab Navigation -->
                <div class="tab-navigation">
                    <button class="tab-btn active" data-tab="offers">
                        <span>Allegro Offers</span>
                    </button>
                    <button class="tab-btn" data-tab="imported">
                        <span>Imported Products</span>
                        <span id="tabImportedCount" class="tab-badge">0</span>
                    </button>
                    <button class="tab-btn" data-tab="csv">
                        <span>CSV Export</span>
                    </button>
                    <button class="tab-btn" data-tab="sync-log">
                        <span>Sync Stock Log</span>
                    </button>
                </div>

                <!-- Tab Content: Offers -->
                <div class="tab-content active" id="tab-offers">
                    <div class="section-card">
                        <div class="section-header">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <button id="loadOffersBtn" class="btn btn-primary" disabled>Load Offers</button>
                            </div>
                            <div class="section-actions">
                                <div class="form-group-inline">
                                    <label for="statusFilter">Status:</label>
                                    <select id="statusFilter" style="min-width: 120px;">
                                        <option value="ALL" selected>All</option>
                                        <option value="ACTIVE">Active</option>
                                        <option value="ENDED">Ended</option>
                                    </select>
                                </div>
                                <div class="offers-search-wrapper">
                                    <input 
                                        type="text" 
                                        id="offerSearchInput" 
                                        class="offers-search-input" 
                                        placeholder="Search offers..."
                                        autocomplete="off">
                                </div>
                                <button id="clearBtn" class="btn btn-secondary" onclick="clearSearch()">Clear</button>
                                <button id="importSelectedBtn" class="btn btn-success" disabled>Import Selected</button>
                            </div>
                        </div>
                        
                        <div id="authRequiredMessage" class="auth-required-message" style="display: none;">
                            Authentication required. Please configure Allegro API first.
                        </div>

                        <div id="loadingIndicator" class="loading" style="display: none;">
                            <div class="spinner"></div>
                            <p>Loading...</p>
                        </div>

                        <div id="errorMessage" class="error-message" style="display: none;">
                            <div class="error-message-content"></div>
                            <button class="error-message-close" onclick="closeErrorMessage()" title="Close">×</button>
                        </div>

                        <div class="pagination" id="pagination" style="display: none;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <button id="prevBtn" class="btn btn-secondary" disabled>Prev</button>
                                <span id="pageInfo">Page 1</span>
                                <button id="nextBtn" class="btn btn-secondary" disabled>Next</button>
                                <div style="display: flex; align-items: center; gap: 5px; margin-left: 15px;">
                                    <label for="pageJumpInput" style="font-size: 14px; color: #666;">Go to:</label>
                                    <input type="number" id="pageJumpInput" min="1" value="1" style="width: 60px; padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <button id="pageJumpBtn" class="btn btn-primary btn-small">Go</button>
                                </div>
                            </div>
                            <span id="totalCountInfo" class="total-count-info"></span>
                        </div>

                        <div id="offersList" class="offers-grid"></div>
                    </div>
                </div>

                <!-- Tab Content: Imported Products -->
                <div class="tab-content" id="tab-imported">
                    <div class="section-card">
                        <div class="section-header">
                            <div class="section-actions">
                                <button id="clearImportedBtn" class="btn btn-secondary btn-small" disabled>Clear</button>
                                <button id="exportToPrestashopBtn" class="btn btn-success btn-small" disabled>Export to PrestaShop</button>
                            </div>
                        </div>
                        <div id="exportProgress" class="export-progress" style="display: none;">
                            <div class="export-progress-bar">
                                <div id="exportProgressBarFill" class="export-progress-fill"></div>
                            </div>
                            <div id="exportProgressText" class="export-progress-text">Preparing export…</div>
                        </div>
                        <div id="importedList" class="imported-list"></div>
                    </div>
                </div>

                <!-- Tab Content: CSV Export -->
                <div class="tab-content" id="tab-csv">
                    <div class="section-card">
                        <div class="csv-export-grid">
                            <div class="csv-export-card">
                            <h3>Export Categories</h3>
                            <p>Export categories from your Allegro offers to a CSV file</p>
                            <button id="exportCategoriesCsvBtn" class="btn btn-primary" disabled>Export Categories</button>
                            </div>
                            <div class="csv-export-card">
                                <h3>Export Products</h3>
                                <p>Export all imported products to a CSV file</p>
                                <button id="exportProductsCsvBtn" class="btn btn-primary" disabled>Export Products</button>
                            </div>
                        </div>
                        <div id="csvExportMessage" class="message" style="display: none; margin-top: 20px;"></div>
                    </div>
                </div>

                <!-- Tab Content: Sync Stock Log -->
                <div class="tab-content" id="tab-sync-log">
                    <div class="section-card">
                        <div class="sync-log-info">
                            <div class="sync-log-info-header">
                                <div class="sync-log-info-content">
                                    <p class="info-text">
                                        <strong>Automatic Stock Sync:</strong> Stock is automatically synced from Allegro to PrestaShop every 5 minutes.
                                        Only products that exist in PrestaShop are synced. Stock changes in PrestaShop do not affect Allegro stock.
                                    </p>
                                    <div class="sync-status" id="syncStatus">
                                        <span class="sync-status-label">Last Sync:</span>
                                        <span id="lastSyncTime" class="sync-status-value">Never</span>
                                        <span class="sync-status-label" style="margin-left: 20px;">Next Sync:</span>
                                        <span id="nextSyncTime" class="sync-status-value">-</span>
                                    </div>
                                </div>
                                <div class="section-actions">
                                    <button id="refreshSyncLogBtn" class="btn btn-primary btn-small">Refresh</button>
                                    <button id="clearSyncLogBtn" class="btn btn-secondary btn-small">Clear Log</button>
                                    <button id="triggerSyncBtn" class="btn btn-success btn-small">Sync Now</button>
                                </div>
                            </div>
                        </div>
                        <div id="syncLogContainer" class="sync-log-container">
                            <div id="syncLogList" class="sync-log-list"></div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="app.js"></script>
</body>
</html>
